
{
  "entities": {
    "Task": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Task",
      "type": "object",
      "description": "Represents a task within the ServiceFlow application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Task entity."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Task)"
        },
        "assigneeId": {
          "type": "string",
          "description": "Reference to StaffMember. (Relationship: StaffMember 1:N Task)"
        },
        "priority": {
          "type": "string",
          "description": "The priority level of the task (High, Medium, Low).",
          "format": "string"
        },
        "creationDate": {
          "type": "string",
          "description": "The date when the task was created.",
          "format": "date-time"
        },
        "resolutionDate": {
          "type": "string",
          "description": "The date when the task was resolved.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A description of the task."
        }
      },
      "required": [
        "id",
        "customerId",
        "assigneeId",
        "priority",
        "creationDate"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer profile.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Customer entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the customer."
        },
        "aadhaarNumber": {
          "type": "string",
          "description": "The Aadhaar number of the customer (encrypted)."
        },
        "panNumber": {
          "type": "string",
          "description": "The PAN number of the customer (encrypted)."
        },
        "passportDetails": {
          "type": "string",
          "description": "The passport details of the customer (encrypted)."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Invoice": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Invoice",
      "type": "object",
      "description": "Represents an invoice uploaded to the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Invoice entity."
        },
        "invoiceNumber": {
          "type": "string",
          "description": "The invoice number."
        },
        "customerName": {
          "type": "string",
          "description": "The name of the customer associated with the invoice."
        },
        "date": {
          "type": "string",
          "description": "The date of the invoice.",
          "format": "date-time"
        },
        "aadhaarNumber": {
          "type": "string",
          "description": "The Aadhaar number extracted from the invoice (optional)."
        }
      },
      "required": [
        "id",
        "customerName",
        "date"
      ]
    },
    "StaffMember": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StaffMember",
      "type": "object",
      "description": "Represents a staff member account.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the StaffMember entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the staff member."
        },
        "skills": {
          "type": "array",
          "description": "An array of strings representing the skills of the staff member.",
          "items": {
            "type": "string"
          }
        },
        "workload": {
          "type": "number",
          "description": "The current workload of the staff member."
        },
        "availability": {
          "type": "boolean",
          "description": "Indicates whether the staff member is currently available."
        }
      },
      "required": [
        "id",
        "name"
      ]
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/customers/{customerId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer profiles. Path-based ownership to control access to customer data.",
          "params": [
            {
              "name": "customerId",
              "description": "The unique identifier of the customer."
            }
          ]
        }
      },
      {
        "path": "/tasks/{taskId}",
        "definition": {
          "entityName": "Task",
          "schema": {
            "$ref": "#/backend/entities/Task"
          },
          "description": "Stores tasks. Includes `customerId` and `assigneeId` for access control.",
          "params": [
            {
              "name": "taskId",
              "description": "The unique identifier of the task."
            }
          ]
        }
      },
      {
        "path": "/staff_members/{staffMemberId}",
        "definition": {
          "entityName": "StaffMember",
          "schema": {
            "$ref": "#/backend/entities/StaffMember"
          },
          "description": "Stores staff member profiles. Admin access is controlled via /roles_admin/{uid}.",
          "params": [
            {
              "name": "staffMemberId",
              "description": "The unique identifier of the staff member."
            }
          ]
        }
      },
      {
        "path": "/invoices/{invoiceId}",
        "definition": {
          "entityName": "Invoice",
          "schema": {
            "$ref": "#/backend/entities/Invoice"
          },
          "description": "Stores invoices. Accessible by authorized users. Includes `customerName` to link to customer data.",
          "params": [
            {
              "name": "invoiceId",
              "description": "The unique identifier of the invoice."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "roles_admin",
          "schema": {
            "$ref": "#/backend/entities/StaffMember"
          },
          "description": "Marks a user as an administrator. Existence of document grants admin privileges.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who is an admin."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the ServiceFlow application's features while adhering to the principles of Authorization Independence, Structural Segregation, and Access Modeling. Task, Customer, Invoice, and StaffMember entities are organized into collections that facilitate secure and scalable data management. The structure prioritizes path-based ownership for user-related data and uses a membership map strategy where applicable. \n\nAuthorization Independence is achieved by denormalizing authorization-related data where needed. For instance, if access to Tasks needed to be restricted based on customer attributes, these attributes would be copied into the Task documents. Currently, the structure assumes direct ownership based on the `customerId` and `assigneeId`, enabling simple rules based on `request.auth.uid`.\n\nStructural Segregation ensures that collections contain documents with similar security needs. This approach simplifies security rules. Private customer data is stored in a way that ensures only authorized staff members can access it. Task assignments link staff members and customers, controlling access based on these relationships.\n\nQAPs are supported through structural segregation and membership models. List operations are secured by ensuring that rules can be applied at the collection level without needing to filter data based on document content.\n\nInvariants such as ownership and timestamps are enforced through the data structure and can be further enforced with Firebase Functions triggered on data changes. The use of explicit state modeling and predictable schema contributes to maintainability and debuggability."
  }
}
